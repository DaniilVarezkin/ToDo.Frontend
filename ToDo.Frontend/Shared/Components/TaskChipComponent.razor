@using ToDo.Shared.Dto.TaskItems
@inject NavigationManager Nav

<MudTooltip Text="@TaskItem.Title">
    <MudChip T="string"
             Size="Size.Small"
             Class="mb-1 clickable"
             Style="max-width:120px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"
             OnClick='() => Nav.NavigateTo($"/tasks/form/{TaskItem.Id}")'
             Color="Color.Primary"
             Variant="Variant.Filled">
        @GetTaskDisplayText(TaskItem)
    </MudChip>
</MudTooltip>

@code {
    [Parameter] public TaskItemLookupDto TaskItem { get; set; } = null!;

    private string GetTaskDisplayText(TaskItemLookupDto t)
    {
        var truncateTitle = Truncate(t.Title, 10);
        if (t.IsAllDay)
            return truncateTitle;

        var time = t.StartDate.LocalDateTime.ToString("HH:mm");
        return $"{time} {truncateTitle}";
    }

    private string Truncate(string value, int maxLength)
    {
        if (string.IsNullOrEmpty(value) || value.Length <= maxLength)
            return value;
        return value.Substring(0, maxLength - 1) + "…";
    }
}